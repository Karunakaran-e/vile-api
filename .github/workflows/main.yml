name: hm-pipeline
on: push
jobs:
  code-build:
    runs-on: self-hosted
    steps:
      - name: code-build
        run: |
          export GIT_SSL_NO_VERIFY=1
          git clone https://github.com/Karunakaran-e/vile-api.git
          echo $(pwd)
          echo "${GITHUB_ACTION_PATH}"
          echo "${GITHUB_WORKSPACE}"
          bash "${GITHUB_WORKSPACE}/build.sh"
  docker-build:
    needs: code-build
    runs-on: self-hosted
    steps:
      - name: docker-build
        run: |
          docker build -t vile-api .
  ecr-push:
    needs: [code-build, docker-build]
    runs-on: self-hosted
    steps:
    - name: ecr-push
      run: echo "Image pushed into ECR"